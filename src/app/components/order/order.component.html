<p>order works!</p>

<mat-card class="custom-card">

  <section
    *ngIf="currentRole === 'cliente' && clientePedidoActual"
    class="client-stepper"
  >
    <div class="client-stepper__header">
      <span class="client-stepper__id">
        Pedido #
        {{ clientePedidoActual.numeroPedido || clientePedidoActual.id || 'N/A' }}
      </span>
      <span class="client-stepper__status">
        Estado actual:
        {{ clientePedidoActual.estado || clientePedidoActual.status || 'Pendiente' }}
      </span>
    </div>

    <div
      class="order-cancelled-banner"
      *ngIf="isPedidoCancelado(clientePedidoActual)"
    >
      Este pedido fue cancelado.
    </div>

    <mat-horizontal-stepper
      class="client-stepper__stepper"
      [linear]="false"
      [selectedIndex]="clienteStepperIndex >= 0 ? clienteStepperIndex : 0"
    >
      <mat-step
        *ngFor="let step of steps; let i = index"
        [completed]="clienteStepperIndex >= 0 && i <= clienteStepperIndex"
      >
        <ng-template matStepLabel>{{ step.label }}</ng-template>
      </mat-step>
    </mat-horizontal-stepper>
  </section>

  <!-- 🔍 Barra de búsqueda -->
  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Buscar pedido</mat-label>
    <input
      matInput
      placeholder="Número, estado, nombre o UID"
      [(ngModel)]="filtro"
      (input)="aplicarFiltro()"
    />
  </mat-form-field>

  <!-- 🧾 Tabla de pedidos -->
  <table *ngIf="pedidosFiltrados.length">
    <thead>
      <tr>
        <th>Número Pedido</th>
        <th>Estado</th>
        <th>Cliente</th>
        <th *ngIf="currentRole !== 'cliente'">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pedido of pedidosFiltrados">
        <td>{{ pedido.numeroPedido }}</td>
        <td>{{ pedido.status }}</td>
        <td>{{ pedido.nombre }}</td>
        <td *ngIf="currentRole !== 'cliente'">
          <button mat-button color="primary" (click)="updateStatus(pedido, 'creado')">
            Creado
          </button>
          <button mat-button color="accent" (click)="updateStatus(pedido, 'en preparación')">
            En preparación
          </button>
          <button mat-button color="warn" (click)="updateStatus(pedido, 'en proceso de entrega')">
            En entrega
          </button>
          <button mat-button color="primary" (click)="updateStatus(pedido, 'entregado')">
            Entregado
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!pedidosFiltrados.length" style="margin: 20px 0;">
    <p>No se encontraron pedidos que coincidan con tu búsqueda.</p>
  </div>

  <!-- 🟦 Stepper de estado -->
  <mat-horizontal-stepper [linear]="true" *ngIf="currentRole !== 'cliente'">
    <mat-step label="state 1">
      <ng-template matStepLabel>Pedido Creado</ng-template>
    </mat-step>
    <mat-step label="state 2">
      <ng-template matStepLabel>En preparación</ng-template>
    </mat-step>
    <mat-step label="state 3">
      <ng-template matStepLabel>En proceso de entrega</ng-template>
    </mat-step>
    <mat-step label="state 4">
      <ng-template matStepLabel>Entregado</ng-template>
    </mat-step>
  </mat-horizontal-stepper>

  <a mat-button color="accent" href="https://wa.me/+5491122544073" target="_blank">Ayuda</a>

</mat-card>
